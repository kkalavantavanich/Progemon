package manager;

import java.util.ArrayList;

import graphic.IRenderableHolder;
import javafx.scene.input.KeyCode;
import logic.character.PlayerCharacter;
import logic.player.HumanPlayer;
import logic.terrain.WorldMap;
import logic.terrain.WorldObject;
import utility.Clock;
import utility.Function;
import utility.InputUtility;

public class WorldManager {
	
	private static PlayerCharacter player;
	private static ArrayList<WorldObject> worldObjects = new ArrayList<>();
	private static WorldMap worldMap;
	private static WorldObject space;
	
	public static PlayerCharacter getPlayer() {
		return player;
	}
	
	public WorldManager() {
		// TODO Auto-generated constructor stub
		WorldObject.loadObjectFunctions();
		WorldObject.loadWorldObjects();
		WorldObject.loadMapObjects("load\\worldmap\\beta\\beta_object.txt");
		int[][] map = {{0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
		              {0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
		              {0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
		              {0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
		              {0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
		              {0, 0, 0, 0, 0, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 0, 0, 0, 0, 0},
		              {0, 0, 0, 0, 0, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 0, 0, 0, 0, 0},
		              {0, 0, 0, 0, 0, -1, -1, 0, 1, 1, 1, 1, 0, 0, 0, -1, -1, 0, 0, 0, 0, 0},
		              {0, 0, 0, 0, 0, -1, -1, 0, 1, 1, 1, 1, 0, 0, 0, -1, -1, 0, 0, 0, 0, 0},
		              {0, 0, 0, 0, 0, -1, -1, 0, 1, 1, 1, 1, 0, 0, 0, -1, -1, 0, 0, 0, 0, 0},
		              {0, 0, 0, 0, 0, -1, -1, 0, 1, 1, 1, 1, 0, 0, 0, -1, -1, 0, 0, 0, 0, 0},
		              {0, 0, 0, 0, 0, -1, -1, 0, 1, 1, 1, 1, 0, 0, 0, -1, -1, 0, 0, 0, 0, 0},
		              {0, 0, 0, 0, 0, -1, -1, 0, 0, 0, 0, 0, 0, 0, 0, -1, -1, 0, 0, 0, 0, 0},
		              {0, 0, 0, 0, 0, -1, -1, 0, 0, 0, 0, 0, 0, 0, 0, -1, -1, 0, 0, 0, 0, 0},
		              {0, 0, 0, 0, 0, -1, -1, 0, 0, 0, 0, 0, 0, 0, 0, -1, -1, 0, 0, 0, 0, 0},
		              {0, 0, 0, 0, 0, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 0, 0, 0, 0, 0},
		              {0, 0, 0, 0, 0, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, 0, 0, 0, 0, 0},
		              {0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
		              {0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
		              {0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
		              {0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
		              {0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0}
		              };
		new Clock();
		WorldMap.loadTileset();
		worldMap = new WorldMap();
		worldMap.setMap(map);
		player = new PlayerCharacter();
		player.setX(WorldMap.PLAYER_START_X * 32);
		player.setY(WorldMap.PLAYER_START_Y * 32);
		player.setBlockX(7);
		player.setBlockY(7);
		IRenderableHolder.addWorldObjects(worldMap);
		WorldObject.loadObjectImages();
		/*WorldObject.createWorldObject(1, 5, 6);
		WorldObject.createWorldObject(1, 7, 6);
		WorldObject.createWorldObject(1, 9, 6);
		WorldObject.createWorldObject(1, 11, 6);
		WorldObject.createWorldObject(1, 13, 6);
		WorldObject.createWorldObject(1, 15, 6);
		WorldObject.createWorldObject(1, 5, 8);
		WorldObject.createWorldObject(1, 15, 8);
		WorldObject.createWorldObject(1, 5, 10);
		WorldObject.createWorldObject(1, 15, 10);
		WorldObject.createWorldObject(1, 5, 12);
		WorldObject.createWorldObject(1, 15, 12);
		WorldObject.createWorldObject(1, 5, 14);
		WorldObject.createWorldObject(1, 15, 14);
		WorldObject.createWorldObject(1, 5, 16);
		WorldObject.createWorldObject(1, 7, 16);
		WorldObject.createWorldObject(1, 9, 16);
		WorldObject.createWorldObject(1, 11, 16);
		WorldObject.createWorldObject(1, 13, 16);
		WorldObject.createWorldObject(1, 15, 16);
		for (int i = 8; i <= 11; i++) {
			for (int j = 7; j <= 11; j++) {
				WorldObject grass = WorldObject.createWorldObject(2, i, j);
				grass.setFrameNumber(5);
				grass.setFrameDelay(5);
				grass.setSpecialDepth(1);
				grass.setAutostop(false);
				IRenderableHolder.removeWorldObjects(grass);
			}
		}*/
		space = WorldObject.createWorldObject(0, -1, -1);
		IRenderableHolder.removeWorldObjects(space);
		space.addOnEnter("-");
		space.addOnExit("-");
		IRenderableHolder.addWorldObjects(player);
		
		manage();
	}
	
	public static void manage() {
		/*player.turn(0);
		player.walk();
		player.walk();
		player.walk();
		player.turn(3);
		player.walk();
		player.walk();
		player.walk();
		player.turn(2);
		player.walk();
		player.walk();
		player.walk();*/
		while(true) {
			if(InputUtility.getKeyPressed(KeyCode.DOWN)) {
				if(player.getDirection() == 0) {
					if(!player.isPlaying()) {
						if(worldMap.getTerrainAt(player.getBlockX(), player.getBlockY() + 1) == -1) {
							player.stuck();
						}
						else{
							player.walk();
						}
					}
				}
				else if(player.isMoving() && !player.isWalking()){
					if(worldMap.getTerrainAt(player.getBlockX(), player.getBlockY() + 1) == -1) {
						player.setDirection(0);
						player.stuck();
					}
					else{
						player.setDirection(0);
						player.walk();
					}
				}
				else if(!player.isPlaying()){
					player.turn(0);
				}
			}
			else if(InputUtility.getKeyPressed(KeyCode.LEFT)) {
				if(player.getDirection() == 1) {
					if(!player.isPlaying()) {
						if(worldMap.getTerrainAt(player.getBlockX() - 1, player.getBlockY()) == -1) {
							player.stuck();
						}
						else{
							player.walk();
						}
					}
				}
				else if(player.isMoving() && !player.isWalking()){
					if(worldMap.getTerrainAt(player.getBlockX() - 1, player.getBlockY()) == -1) {
						player.setDirection(1);
						player.stuck();
					}
					else{
						player.setDirection(1);
						player.walk();
					}
				}
				else if(!player.isPlaying()){
					player.turn(1);
				}
			}
			else if(InputUtility.getKeyPressed(KeyCode.UP)) {
				if(player.getDirection() == 2) {
					if(!player.isPlaying()) {
						if(worldMap.getTerrainAt(player.getBlockX(), player.getBlockY() - 1) == -1) {
							player.stuck();
						}
						else{
							player.walk();
						}
					}
				}
				else if(player.isMoving() && !player.isWalking()){
					if(worldMap.getTerrainAt(player.getBlockX(), player.getBlockY() - 1) == -1) {
						player.setDirection(2);
						player.stuck();
					}
					else{
						player.setDirection(2);
						player.walk();
					}
				}
				else if(!player.isPlaying()){
					player.turn(2);
				}
			}
			else if(InputUtility.getKeyPressed(KeyCode.RIGHT)) {
				if(player.getDirection() == 3) {
					if(!player.isPlaying()) {
						if(worldMap.getTerrainAt(player.getBlockX() + 1, player.getBlockY()) == -1) {
							player.stuck();
						}
						else{
							player.walk();
						}
					}
				}
				else if(player.isMoving() && !player.isWalking()){
					if(worldMap.getTerrainAt(player.getBlockX() + 1, player.getBlockY()) == -1) {
						player.setDirection(3);
						player.stuck();
					}
					else{
						player.setDirection(3);
						player.walk();
					}
				}
				else if(!player.isPlaying()){
					player.turn(3);
				}
			}
			else if(!player.isStucking() && !player.isWalking()) {
				player.setMoving(false);
			}
			Clock.tick();
		}
	}
	
	public static void addWorldObjects(WorldObject worldObject){
		worldObjects.add(worldObject);
	}
	
	public static WorldObject getObjectAt(int x, int y) {
		for (WorldObject worldObject : worldObjects) {
			if (worldObject.getBlockX() == x && worldObject.getBlockY() == y) {
				return worldObject;
			}
		}
		return space;
	}

}
